<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Learning Dashboard | PathLift</title>

  <link rel="stylesheet" href="assets/styles.css" />
  <script defer src="assets/lessons.js"></script>
  <script defer src="assets/main.js"></script>
</head>
<body>
  <a href="#main" class="skip-link">Skip to content</a>

  <header class="header">
    <div class="container nav">
      <a class="brand" href="index.html">
        <span class="brand-logo"></span>
        <span class="brand-name">PathLift</span>
      </a>
      <nav>
        <div class="nav-links">
          <a href="learn.html" aria-current="page">Dashboard</a>
          <a href="profile.html">Profile</a>
        </div>
      </nav>
    </div>
  </header>

  <main id="main" class="section">
    <div class="container">
      <div class="card">
        <h1>Welcome, <span id="username"></span></h1>
        <p class="muted">Choose a track and start learning. Your progress is saved on this device.</p>
      </div>

      <div id="tracks" class="grid grid-2 space-md"></div>
    </div>
  </main>

  <script>
    // Wait until scripts are loaded
    document.addEventListener("DOMContentLoaded", () => {
      try {
        const user = Pathlift.requireUser();
        document.getElementById("username").textContent = user.name;

        const tracksContainer = document.getElementById("tracks");

        if (typeof PATHLIFT_TRACKS === "undefined") {
          tracksContainer.innerHTML = `
            <div class="card">
              <h3>Curriculum not loaded</h3>
              <p class="muted">Make sure <code>assets/lessons.js</code> exists and is linked correctly.</p>
            </div>
          `;
          return;
        }

        const progress = Pathlift.getProgress();

        PATHLIFT_TRACKS.forEach(track => {
          const totalLessons = track.lessons.length;
          const completed = track.lessons.filter(l => progress.completedLessons.includes(l.id)).length;
          const percent = Math.round((completed / totalLessons) * 100);

          const card = document.createElement("div");
          card.className = "card";

          const h3 = document.createElement("h3");
          h3.textContent = track.name;
          card.appendChild(h3);

          const p = document.createElement("p");
          p.className = "muted";
          p.textContent = track.description;
          card.appendChild(p);

          const barOuter = document.createElement("div");
          barOuter.className = "progress-bar";

          const barInner = document.createElement("div");
          barInner.className = "progress-fill";
          barInner.style.width = percent + "%";
          barOuter.appendChild(barInner);
          card.appendChild(barOuter);

          const small = document.createElement("small");
          small.className = "muted";
          small.textContent = `${completed} of ${totalLessons} lessons completed`;
          card.appendChild(small);

          const list = document.createElement("ul");
          list.className = "checklist space-md";

          track.lessons.forEach(lesson => {
            const li = document.createElement("li");
            const icon = document.createElement("span");
            icon.className = "icon";
            icon.textContent = Pathlift.isLessonComplete(lesson.id) ? "✓" : "•";
            const span = document.createElement("span");
            span.textContent = lesson.title;
            li.appendChild(icon);
            li.appendChild(span);

            li.style.cursor = "pointer";
            li.addEventListener("click", () => {
              Pathlift.setCurrentLesson(lesson.id);
              window.location.href = "lesson.html";
            });

            list.appendChild(li);
          });

          card.appendChild(list);
          tracksContainer.appendChild(card);
        });
      } catch (err) {
        console.error(err);
        const tracksContainer = document.getElementById("tracks");
        tracksContainer.innerHTML = `
          <div class="card">
            <h3>Something went wrong</h3>
            <p class="muted">Check the browser console for details.</p>
          </div>
        `;
      }
    });
  </script>
</body>
</html>
