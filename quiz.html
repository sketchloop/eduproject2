<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quiz</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 40px auto; }
    .hidden { display: none; }
    .error { color: red; margin-bottom: 16px; }
    .question { font-weight: bold; margin-bottom: 8px; }
    .options button { display: block; margin: 4px 0; }
    #result { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Quiz</h1>

  <div id="error" class="error hidden"></div>

  <div>
    <label for="trackSelect"><strong>Select track:</strong></label>
    <select id="trackSelect"></select>
    <button id="startBtn">Start Quiz</button>
  </div>

  <div id="quizContainer" class="hidden">
    <div id="question" class="question"></div>
    <div id="options" class="options"></div>
    <button id="nextBtn" class="hidden">Next</button>
    <div id="result"></div>
  </div>

  <!-- Correct path to your data file inside /assets -->
  <script src="./assets/quiz-data-help-me-jesus-christ.js?v=1"></script>

  <script>
    (function () {
      const errorEl = document.getElementById("error");
      const trackSelect = document.getElementById("trackSelect");
      const startBtn = document.getElementById("startBtn");
      const quizContainer = document.getElementById("quizContainer");
      const questionEl = document.getElementById("question");
      const optionsEl = document.getElementById("options");
      const nextBtn = document.getElementById("nextBtn");
      const resultEl = document.getElementById("result");

      function showError(msg) {
        errorEl.textContent = msg;
        errorEl.classList.remove("hidden");
        quizContainer.classList.add("hidden");
      }

      // Validate QUIZZES
      if (typeof QUIZZES === "undefined" || QUIZZES === null || typeof QUIZZES !== "object") {
        showError("Quiz data file (quiz-data-help-me-jesus-christ.js) did not load or QUIZZES is not defined.");
        return;
      }

      const tracks = Object.keys(QUIZZES);
      if (!tracks.length) {
        showError("No quiz tracks found in QUIZZES.");
        return;
      }

      // Populate dropdown
      tracks.forEach((key) => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = key;
        trackSelect.appendChild(opt);
      });

      let currentTrack = null;
      let currentIndex = 0;
      let score = 0;
      let answered = false;

      function renderQuestion() {
        if (!currentTrack || currentIndex >= currentTrack.length) {
          questionEl.textContent = "Quiz complete!";
          optionsEl.innerHTML = "";
          nextBtn.classList.add("hidden");
          resultEl.textContent = "Your score: " + score + " / " + currentTrack.length;
          return;
        }

        const q = currentTrack[currentIndex];
        questionEl.textContent = q.q;
        optionsEl.innerHTML = "";
        resultEl.textContent = "";
        answered = false;

        q.options.forEach((optText, idx) => {
          const btn = document.createElement("button");
          btn.textContent = optText;
          btn.addEventListener("click", () => {
            if (answered) return;
            answered = true;
            if (idx === q.correct) {
              score++;
              resultEl.textContent = "Correct!";
            } else {
              resultEl.textContent = "Incorrect.";
            }
            nextBtn.classList.remove("hidden");
          });
          optionsEl.appendChild(btn);
        });
      }

      startBtn.addEventListener("click", () => {
        const selectedKey = trackSelect.value;
        const trackData = QUIZZES[selectedKey];

        if (!Array.isArray(trackData) || !trackData.length) {
          showError("Selected track has no questions or is invalid.");
          return;
        }

        errorEl.classList.add("hidden");
        quizContainer.classList.remove("hidden");

        currentTrack = trackData;
        currentIndex = 0;
        score = 0;
        nextBtn.classList.add("hidden");
        renderQuestion();
      });

      nextBtn.addEventListener("click", () => {
        currentIndex++;
        nextBtn.classList.add("hidden");
        renderQuestion();
      });
    })();
  </script>
</body>
</html>
